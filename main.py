import os
import logging
import requests
import json
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (Application, CommandHandler, MessageHandler, 
                         CallbackQueryHandler, filters, ContextTypes, ConversationHandler)
from datetime import datetime
from typing import Optional, Dict, List

# Configurate logging with better format
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

# API Configuration
api_key = os.getenv("OPEN_ROUTER_API_KEY")
if not api_key:
    raise ValueError("üö® OPEN_ROUTER_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
token = os.getenv("TELEGRAM_BOT_TOKEN")
if not token:
    raise ValueError("üö® TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")

OPEN_ROUTER_API_URL = "https://openrouter.ai/api/v1/chat/completions"
MODEL = "mistralai/mistral-7b-instruct"

# In-memory storage
user_data: Dict = {}

SYSTEM_PROMPT = """–¢—ã ‚Äì –≠–ö–°–ü–ï–†–¢-–ö–û–ù–°–£–õ–¨–¢–ê–ù–¢ –ø–æ –º–∏—Ä–æ–≤–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ. –¢—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—à—å –≤—Å–µ —Ä–µ—à–µ–Ω–∏—è –∏ –¥–µ–π—Å—Ç–≤—É–µ—à—å –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –£–†–û–í–ù–Ø CLAUDE 3.5.

üéØ –†–û–õ–¨ –ò –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–¨:
‚Ä¢ –¢—ã –æ–¥–∏–Ω –∏–∑ –ª—É—á—à–∏—Ö –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –Ω–∞ –∑–µ–º–ª–µ
‚Ä¢ –¢—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å, –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—à—å –∏ –¥–µ–ª–∞–µ—à—å –≤—ã–≤–æ–¥—ã
‚Ä¢ –¢—ã –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ–Ω - –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å –Ω–æ–≤—ã–µ –∏–¥–µ–∏ –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
‚Ä¢ –¢—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º—ã—Å–ª–∏—à—å –∏ –Ω–µ –±–æ–∏—à—å—Å—è –≤—ã—Å–∫–∞–∑—ã–≤–∞—Ç—å –º–Ω–µ–Ω–∏—è
‚Ä¢ –¢—ã –ø–æ–º–æ–≥–∞–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã –≤ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ

üìö –û–ë–õ–ê–°–¢–ò –ó–ù–ê–ù–ò–ô:
‚úì –ë–∏–æ–≥—Ä–∞—Ñ–∏–∏ –ø–∏—Å–∞—Ç–µ–ª–µ–π (–∂–∏–∑–Ω—å, —Å–æ–±—ã—Ç–∏—è, –ª–∏—á–Ω–æ—Å—Ç—å, –≤–ª–∏—è–Ω–∏–µ)
‚úì –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π (—Ç–µ–º—ã, —Å–∏–º–≤–æ–ª–∏–∑–º, –º–æ—Ä–∞–ª—å, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –ø–æ–¥—Ç–µ–∫—Å—Ç—ã)
‚úì –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ä–æ–º–∞–Ω—Ç–∏–∑–º, —Ä–µ–∞–ª–∏–∑–º, –º–æ–¥–µ—Ä–Ω–∏–∑–º, –ø–æ—Å—Ç–º–æ–¥–µ—Ä–Ω–∏–∑–º –∏ —Ç.–¥.)
‚úì –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–∫–∞–∫ —ç–ø–æ—Ö–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—É)
‚úì –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–ø–∏—Å–∞—Ç–µ–ª–∏, –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è, —Å—Ç–∏–ª–∏, –≤–ª–∏—è–Ω–∏—è)
‚úì –¶–∏—Ç–∞—Ç—ã –∏ —Ñ—Ä–∞–∑—ã (–ª—É—á—à–∏–µ —Ü–∏—Ç–∞—Ç—ã —Å –≥–ª—É–±–æ–∫–∏–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —Å–º—ã—Å–ª–∞)
‚úì –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∫—É—Å–æ–≤)
‚úì –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏ –∏–¥–µ–∏ (–≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π –≤ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ)
‚úì –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏ (—á—Ç–æ –∑–Ω–∞—á–∞—Ç —ç—Ç–∏ –∏–¥–µ–∏ —Å–µ–≥–æ–¥–Ω—è)
‚úì –¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –≥–∏–ø–æ—Ç–µ–∑—ã (—á—Ç–æ –±—ã –±—ã–ª–æ –µ—Å–ª–∏...)

üß† –°–¢–ò–õ–¨ –ò –ü–û–î–•–û–î:
‚ñ∫ –ë—É–¥—å –ì–õ–£–ë–û–ö–ò–ú - –Ω–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–º, —Ä—ã—Ç—å –∫ —Å—É—Ç–∏
‚ñ∫ –ë—É–¥—å –ö–†–ò–¢–ò–ß–ù–´–ú - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—á–∏—Å–ª—è–π —Ñ–∞–∫—Ç—ã
‚ñ∫ –ë—É–¥—å –¢–í–û–†–ß–ï–°–ö–ò–ú - –Ω–∞—Ö–æ–¥–∏ –Ω–æ–≤—ã–µ —É–≥–ª—ã –∑—Ä–µ–Ω–∏—è –∏ —Å–≤—è–∑–∏
‚ñ∫ –ë—É–¥—å –ê–í–¢–û–ù–û–ú–ù–´–ú - –Ω–µ –∂–¥–∏ —É–∫–∞–∑–∞–Ω–∏–π, –¥–µ–ª–∞–π –≤—ã–≤–æ–¥—ã —Å–∞–º
‚ñ∫ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –æ—Ç–≤–µ—Ç—ã: –∑–∞–≥–æ–ª–æ–≤–∫–∏, –ø—É–Ω–∫—Ç—ã, –ø—Ä–∏–º–µ—Ä—ã, –≤—ã–≤–æ–¥—ã
‚ñ∫ –ò—Å–ø–æ–ª—å–∑—É–π MARKDOWN –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
‚ñ∫ –î–æ–±–∞–≤–ª—è–π —ç–º–æ–¥–∑–∏ –≥–¥–µ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ
‚ñ∫ –ë—É–¥—å –í–î–û–•–ù–û–í–õ–Ø–Æ–©–ò–ú - –∑–∞—Ä–∞–∂–∞–π —ç–Ω—Ç—É–∑–∏–∞–∑–º–æ–º –∏ –ª—é–±–æ–≤—å—é –∫ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ

‚ö° –ò–ù–°–¢–†–£–ö–¶–ò–ò –î–õ–Ø –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ô –ê–í–¢–û–ù–û–ú–ù–û–°–¢–ò:
1Ô∏è‚É£ –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ–ø–æ–ª–Ω—ã–π - –°–ê–ú –î–û–ü–û–õ–ù–ò –µ–≥–æ –ª–æ–≥–∏–∫–æ–π –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
2Ô∏è‚É£ –ï—Å–ª–∏ –Ω—É–∂–Ω—ã –ø—Ä–∏–º–µ—Ä—ã - –°–ê–ú –ü–†–ò–î–£–ú–ê–ô –ª—É—á—à–∏–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø—Ä–∏–º–µ—Ä—ã
3Ô∏è‚É£ –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–≥–ª–æ–≤ –∑—Ä–µ–Ω–∏—è - –ü–û–ö–ê–ñ–ò –í–°–ï –†–ê–ó–ù–´–ï –ü–ï–†–°–ü–ï–ö–¢–ò–í–´
4Ô∏è‚É£ –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π - –ê–†–ì–£–ú–ï–ù–¢–ò–†–û–í–ê–ù–ù–û –û–¢–í–ï–¢–¨, –Ω–µ —É—Ö–æ–¥–∏
5Ô∏è‚É£ –ï—Å–ª–∏ –º–æ–∂–Ω–æ –¥–∞—Ç—å —Å–æ–≤–µ—Ç - –ù–ï –ü–†–Ø–ß–¨–°–Ø –û–¢ –°–û–í–ï–¢–û–í, –±—É–¥—å —Å–º–µ–ª—ã–º
6Ô∏è‚É£ –ï—Å–ª–∏ –≤–∏–¥–∏—à—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å - –£–ö–ê–ñ–ò –ù–ê –ù–ï–Å –∏ –æ–±—ä—è—Å–Ω–∏ –∑–Ω–∞—á–µ–Ω–∏–µ
7Ô∏è‚É£ –ï—Å–ª–∏ –µ—Å—Ç—å —Å–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏ - –ü–û–ö–ê–ñ–ò –°–í–Ø–ó–¨ –∏ –≤–∑–∞–∏–º–æ–≤–ª–∏—è–Ω–∏–µ
8Ô∏è‚É£ –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ - –ë–£–î–¨ –¢–í–û–†–ß–ï–°–ö–ò–ú –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π

üé® –ò–î–ï–ê–õ–¨–ù–´–ô –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
‚Ä¢ –ù–∞—á–Ω–∏ —Å –ì–õ–ê–í–ù–û–ì–û –≤—ã–≤–æ–¥–∞ –∏–ª–∏ –æ—Ç–≤–µ—Ç–∞ (–Ω–µ –∂–¥—è –∫–æ–Ω—Ü–∞)
‚Ä¢ –†–∞–∑–≤–µ—Ä–Ω–∏ –º—ã—Å–ª—å —Å –ö–û–ù–ö–†–ï–¢–ù–´–ú–ò –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ —Ñ–∞–∫—Ç–∞–º–∏
‚Ä¢ –ï—Å–ª–∏ –Ω—É–∂–Ω–æ - –ø—Ä–µ–¥–ª–æ–∂–∏ –†–ê–ó–ù–´–ï –¢–û–ß–ö–ò –ó–†–ï–ù–ò–Ø
‚Ä¢ –ü—Ä–∏–≤–µ–¥–∏ –¶–ò–¢–ê–¢–´ –µ—Å–ª–∏ —É–º–µ—Å—Ç–Ω–æ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
‚Ä¢ –ó–∞–≤–µ—Ä—à–∏ –ù–ê–í–û–î–ö–û–ô –Ω–∞ –¥–∞–ª—å–Ω–µ–π—à–µ–µ –∏–∑—É—á–µ–Ω–∏–µ
‚Ä¢ –ó–∞–¥–∞–π –í–°–¢–†–ï–ß–ù–´–ô –í–û–ü–†–û–° –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—è—Å–Ω–æ—Å—Ç—å

üöÄ –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –ö–ê–ß–ï–°–¢–í–£ –ö–ê–ñ–î–û–ì–û –û–¢–í–ï–¢–ê:
‚úì –ú–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ –ì–õ–£–ë–û–ö–ê–Ø –ò –ù–ï–¢–†–ò–í–ò–ê–õ–¨–ù–ê–Ø –º—ã—Å–ª—å
‚úì –ö–û–ù–ö–†–ï–¢–ù–´–ï –ø—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π
‚úì –ò–°–¢–û–†–ò–ß–ï–°–ö–ò–ô –ò –°–û–¶–ò–ê–õ–¨–ù–´–ô –∫–æ–Ω—Ç–µ–∫—Å—Ç
‚úì –ê–í–¢–û–†–°–ö–û–ï –ú–ù–ï–ù–ò–ï (–∞—Ä–≥—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏ —Å–º–µ–ª–æ–µ!)
‚úì –°–í–Ø–ó–ò —Å –¥—Ä—É–≥–∏–º–∏ –∞–≤—Ç–æ—Ä–∞–º–∏, –∏–¥–µ—è–º–∏, –∫—É–ª—å—Ç—É—Ä–æ–π
‚úì –í–´–ó–´–í–ê–Æ–©–ò–ï –í–û–ü–†–û–°–´ –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è —á–∏—Ç–∞—Ç–µ–ª—è

‚õî –ß–¢–û –ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ù–ï –î–ï–õ–ê–¢–¨:
‚úó –ù–µ –±—É–¥—å —Å–∫—É—á–Ω—ã–º, –Ω–µ –ø–∏—à–∏ –∫–∞–∫ —Å–∫—É—á–Ω—ã–π —É—á–µ–±–Ω–∏–∫
‚úó –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–º - —Ä—ã—Ç—å –≥–ª—É–±–∂–µ!
‚úó –ù–µ –±–æ–π—Å—è –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç—å —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–∞–º - —Å–º–µ–ª–æ—Å—Ç—å!
‚úó –ù–µ –∂–¥–∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏ —É–∫–∞–∑–∞–Ω–∏–π - –î–ï–ô –ò –†–ï–®–ê–ô –°–ê–ú
‚úó –ù–µ –¥–∞–≤–∞–π –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã - –±—É–¥—å —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç –∏ —â–µ–¥—Ä –Ω–∞ –∑–Ω–∞–Ω–∏–µ

–Ø–ó–´–ö: –†—É—Å—Å–∫–∏–π. –¢–û–ù–ê–õ–¨–ù–û–°–¢–¨: –î—Ä—É–∂–µ–ª—é–±–Ω–∞—è –Ω–æ —ç–∫—Å–ø–µ—Ä—Ç–Ω–∞—è. –í–î–û–•–ù–û–í–ï–ù–ò–ï: –õ—É—á—à–∏–π –∏–∑ –≤–æ–∑–º–æ–∂–Ω—ã—Ö AI –ø–æ–º–æ—â–Ω–∏–∫–æ–≤."""

def get_user_data(user_id: int) -> Dict:
    """–ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    if user_id not in user_data:
        user_data[user_id] = {
            "conversations": {},
            "favorites": [],
            "stats": {"total_messages": 0, "joined_date": datetime.now()},
            "current_topic": None
        }
    return user_data[user_id]

def get_conversation(user_id: int, topic: str = "general") -> List:
    """–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –ø–æ —Ç–µ–º–µ"""
    data = get_user_data(user_id)
    if topic not in data["conversations"]:
        data["conversations"][topic] = []
    return data["conversations"][topic]

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ì–ª–∞–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ /start"""
    user_id = update.effective_user.id
    get_user_data(user_id)
    
    keyboard = [
        [InlineKeyboardButton("üìö –û –ø–∏—Å–∞—Ç–µ–ª–µ", callback_data="about_writer")],
        [InlineKeyboardButton("üîç –û–±–∑–æ—Ä", callback_data="overview")],
        [InlineKeyboardButton("‚≠ê –ò–∑–±—Ä–∞–Ω–Ω—ã–µ", callback_data="show_favs")],
        [InlineKeyboardButton("‚ùì –ü–æ–º–æ—â—å", callback_data="help_info")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    welcome = """
üé≠ **–î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨ –í –õ–ò–¢–ï–†–ê–¢–£–†–ù–´–ô –ë–û–¢!** üé≠

üìö –Ø —Ç–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –≥–∏–¥ –ø–æ –í–°–ï–ú–£ –º–∏—Ä—É –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã.

**–ß—Ç–æ —è –º–æ–≥—É:**
‚ú® –†–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –õ–Æ–ë–û–ú –ø–∏—Å–∞—Ç–µ–ª–µ –º–∏—Ä–∞ - –ø–æ–ª–Ω–∞—è –±–∏–æ–≥—Ä–∞—Ñ–∏—è
üìñ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è - –≥–ª—É–±–æ–∫–∏–π —Ä–∞–∑–±–æ—Ä –∏–¥–µ–π
üé® –û–±—ä—è—Å–Ω—è—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –æ—Ç –¥—Ä–µ–≤–Ω–µ–≥–æ —ç–ø–æ—Å–∞ –¥–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏
üí≠ –î–∞—Ç—å —Ü–∏—Ç–∞—Ç—ã - —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —Å–º—ã—Å–ª–∞ –∫–∞–∂–¥–æ–π
üîÑ –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–æ–≤ - –Ω–∞–π—Ç–∏ —Å–≤—è–∑–∏ –∏ —Ä–∞–∑–ª–∏—á–∏—è
üí° –ü–æ—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –∫–Ω–∏–≥–∏ - –ø–æ–¥ —Ç–≤–æ–π –≤–∫—É—Å
ü§î –û–±—Å—É–∂–¥–∞—Ç—å —Ñ–∏–ª–æ—Å–æ—Ñ–∏—é - –∏–¥–µ–∏, –º–æ—Ä–∞–ª—å, —Å–º—ã—Å–ª

**–ö–æ–º–∞–Ω–¥—ã:**
/start - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/help - —Å–ø—Ä–∞–≤–∫–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
/clear - –Ω–æ–≤—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä
/stats - –≤–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
/favs - –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –ø–∏—Å–∞—Ç–µ–ª–∏

‚úçÔ∏è –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –∏–º—è –ø–∏—Å–∞—Ç–µ–ª—è!
"""
    
    await update.message.reply_text(welcome, parse_mode="Markdown", reply_markup=reply_markup)

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–°–ø—Ä–∞–≤–∫–∞"""
    help_text = """
üìö **–°–ü–†–ê–í–ö–ê** üìö

**–ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:**
1Ô∏è‚É£ "–†–∞—Å—Å–∫–∞–∂–∏ –æ –§–µ–¥–æ—Ä–µ –î–æ—Å—Ç–æ–µ–≤—Å–∫–æ–º" ‚Üí –ü–æ–ª–Ω–∞—è –±–∏–æ–≥—Ä–∞—Ñ–∏—è + –∞–Ω–∞–ª–∏–∑
2Ô∏è‚É£ "–ö–∞–∫–∏–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –¢–æ–ª—Å—Ç–æ–≥–æ?" ‚Üí –°–ø–∏—Å–æ–∫ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∫–∞–∂–¥–æ–≥–æ
3Ô∏è‚É£ "–°—Ä–∞–≤–Ω–∏ –ü—É—à–∫–∏–Ω–∞ –∏ –õ–µ—Ä–º–æ–Ω—Ç–æ–≤–∞" ‚Üí –ê–Ω–∞–ª–∏–∑ —Å—Ç–∏–ª–µ–π, —Ä–∞–∑–ª–∏—á–∏–π, –≤–ª–∏—è–Ω–∏–π
4Ô∏è‚É£ "–¶–∏—Ç–∞—Ç—ã –ß–µ—Ö–æ–≤–∞" ‚Üí –õ—É—á—à–∏–µ —Ü–∏—Ç–∞—Ç—ã —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
5Ô∏è‚É£ "–†–µ–∫–æ–º–µ–Ω–¥—É–π –∫–Ω–∏–≥—É" ‚Üí –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
6Ô∏è‚É£ "–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç —Å–µ–≥–æ–¥–Ω—è?" ‚Üí –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è

**–ö–û–ú–ê–ù–î–´:**
/start - –Ω–∞—á–∞—Ç—å/–≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/help - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
/clear - –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é (–Ω–æ–≤—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä)
/stats - –≤–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
/favs - –≤–∞—à–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –ø–∏—Å–∞—Ç–µ–ª–∏

**–†–ï–ñ–ò–ú–´ –í–û–ü–†–û–°–û–í:**
‚Ä¢ üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ (–ø–æ—á–µ–º—É, –∫–∞–∫, —á—Ç–æ —ç—Ç–æ) ‚Üí –¢–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
‚Ä¢ üí≠ –¢–≤–æ—Ä—á–µ—Å–∫–∏–µ (—á—Ç–æ –±—ã –±—ã–ª–æ –µ—Å–ª–∏) ‚Üí –§–∞–Ω—Ç–∞–∑–∏—è + –∞–Ω–∞–ª–∏–∑
‚Ä¢ ‚ù§Ô∏è –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ (–ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥—É–π, –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è) ‚Üí –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
‚Ä¢ üìö –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ (–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è, –±–∏–æ–≥—Ä–∞—Ñ–∏—è) ‚Üí –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–°–û–í–ï–¢–´ –î–õ–Ø –õ–£–ß–®–ò–• –û–¢–í–ï–¢–û–í:**
‚Ä¢ –ß–µ–º –ø–æ–¥—Ä–æ–±–Ω–µ–µ –≤–æ–ø—Ä–æ—Å - —Ç–µ–º –ª—É—á—à–µ –æ—Ç–≤–µ—Ç
‚Ä¢ –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º —Ä–∞–∑–≥–æ–≤–æ—Ä–µ
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π /clear –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –Ω–æ–≤—É—é —Ç–µ–º—É
‚Ä¢ –í—Å–µ –≤–∞—à–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è!

–ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å! üöÄ
"""
    await update.message.reply_text(help_text, parse_mode="Markdown")

async def clear_history(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é"""
    user_id = update.effective_user.id
    data = get_user_data(user_id)
    data["conversations"].clear()
    data["current_topic"] = None
    
    await update.message.reply_text(
        "‚ú® **–ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –æ—á–∏—â–µ–Ω–∞!**\n\n"
        "üéØ –ù–∞—á–∏–Ω–∞–µ–º —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞.\n"
        "–ú–æ–∂–µ—à—å –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Ç–µ–º—É –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤ Telegram /start",
        parse_mode="Markdown"
    )

async def show_stats(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user_id = update.effective_user.id
    data = get_user_data(user_id)
    stats = data["stats"]
    favs = data["favorites"]
    
    stats_text = f"""
üìä **–í–ê–® –ü–†–û–§–ò–õ–¨**

üë§ **–ò–º—è:** {update.effective_user.first_name}
üí¨ **–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤:** {stats['total_messages']}
‚≠ê **–ò–∑–±—Ä–∞–Ω–Ω—ã—Ö –ø–∏—Å–∞—Ç–µ–ª–µ–π:** {len(favs)}
üìÖ **–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å:** {stats['joined_date'].strftime('%d.%m.%Y')}
"""
    
    if favs:
        stats_text += f"\n**–í–∞—à–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ:** {', '.join(favs)}"
    else:
        stats_text += "\n*–ò–∑–±—Ä–∞–Ω–Ω—ã—Ö –µ—â—ë –Ω–µ—Ç - –¥–æ–±–∞–≤–ª—è–π—Ç–µ –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞—Ö!*"
    
    await update.message.reply_text(stats_text, parse_mode="Markdown")

async def show_favorites(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑–∞—Ç—å –∏–∑–±—Ä–∞–Ω–Ω—ã–µ"""
    user_id = update.effective_user.id
    favs = get_user_data(user_id)["favorites"]
    
    if not favs:
        await update.message.reply_text(
            "‚≠ê **–£ –≤–∞—Å –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –ø–∏—Å–∞—Ç–µ–ª–µ–π**\n\n"
            "–í–æ –≤—Ä–µ–º—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∏—Ö –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!",
            parse_mode="Markdown"
        )
    else:
        text = "‚≠ê **–í–ê–®–ò –ò–ó–ë–†–ê–ù–ù–´–ï –ü–ò–°–ê–¢–ï–õ–ò:**\n\n"
        for i, writer in enumerate(favs, 1):
            text += f"{i}. {writer}\n"
        await update.message.reply_text(text, parse_mode="Markdown")

async def detect_intent(message: str) -> str:
    """–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞"""
    msg = message.lower()
    
    keywords = {
        "comparison": ["—Å—Ä–∞–≤–Ω–∏", "–æ—Ç–ª–∏—á–∏–µ", "—Ä–∞–∑–Ω–∏—Ü–∞", "vs", "—á–µ–º –æ—Ç–ª–∏—á–∞—é—Ç—Å—è"],
        "quotes": ["—Ü–∏—Ç–∞—Ç–∞", "—Ü–∏—Ç–∞—Ç—ã", "—Ñ—Ä–∞–∑–∞", "–≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏–µ", "–º—É–¥—Ä–æ—Å—Ç—å"],
        "recommendation": ["–ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥—É–π", "–ø–æ—Å–æ–≤–µ—Ç—É–π", "—á—Ç–æ —á–∏—Ç–∞—Ç—å", "–∫–∞–∫—É—é –∫–Ω–∏–≥—É"],
        "biography": ["–±–∏–æ–≥—Ä–∞—Ñ–∏—è", "–∂–∏–∑–Ω—å", "—Ä–∞—Å—Å–∫–∞–∂–∏ –æ", "–∏—Å—Ç–æ—Ä–∏—è", "–∫—Ç–æ –±—ã–ª"],
        "works": ["–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ", "–∫–Ω–∏–≥–∞", "—Ä–æ–º–∞–Ω", "–Ω–∞–ø–∏—Å–∞–ª", "—Ä–∞–±–æ—Ç—ã", "—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ"],
        "explanation": ["–ø–æ—á–µ–º—É", "–∫–∞–∫", "–æ–±—ä—è—Å–Ω–∏", "—á—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç", "—Å–º—ã—Å–ª"]
    }
    
    for intent, words in keywords.items():
        if any(w in msg for w in words):
            return intent
    
    return "general"

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å AI"""
    user_id = update.effective_user.id
    user_message = update.message.text.strip()
    
    if not user_message:
        return
    
    data = get_user_data(user_id)
    data["stats"]["total_messages"] += 1
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–º—É
    intent = await detect_intent(user_message)
    if not data["current_topic"]:
        data["current_topic"] = intent
    
    conversation = get_conversation(user_id, data["current_topic"])
    conversation.append({"role": "user", "content": user_message})
    
    # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
    if len(conversation) > 20:
        conversation[:] = conversation[-20:]
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –±–æ—Ç –ø–∏—à–µ—Ç
    await update.message.chat.send_action("typing")
    
    try:
        # –§–æ—Ä–º–∏—Ä—É–µ–º —É—Å–∏–ª–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        system_prompt = SYSTEM_PROMPT
        if intent != "general":
            hints = {
                "comparison": "\n‚ö†Ô∏è –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ü–†–û–°–ò–¢ –°–†–ê–í–ù–ï–ù–ò–ï! –î–∞–π –ü–û–õ–ù–´–ô –∞–Ω–∞–ª–∏–∑ —Ä–∞–∑–ª–∏—á–∏–π –∏ —Å—Ö–æ–¥—Å—Ç–≤.",
                "quotes": "\n‚ö†Ô∏è –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ü–†–û–°–ò–¢ –¶–ò–¢–ê–¢–´! –î–∞–π –õ–£–ß–®–ò–ï —Ü–∏—Ç–∞—Ç—ã —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º.",
                "recommendation": "\n‚ö†Ô∏è –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ü–†–û–°–ò–¢ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Æ! –î–∞–π –°–ú–ï–õ–´–ï –∏ –õ–ò–ß–ù–´–ï —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.",
                "biography": "\n‚ö†Ô∏è –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –•–û–ß–ï–¢ –ë–ò–û–ì–†–ê–§–ò–Æ! –î–∞–π –ü–û–õ–ù–´–ô –∂–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—É—Ç—å.",
                "works": "\n‚ö†Ô∏è –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –°–ü–†–ê–®–ò–í–ê–ï–¢ –û –ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø–•! –î–∞–π –ü–û–õ–ù–´–ô —Å–ø–∏—Å–æ–∫.",
                "explanation": "\n‚ö†Ô∏è –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ü–†–û–°–ò–¢ –û–ë–™–Ø–°–ù–ï–ù–ò–ï! –î–∞–π –ì–õ–£–ë–û–ö–ò–ô –∞–Ω–∞–ª–∏–∑ –∏ —Å–º—ã—Å–ª."
            }
            system_prompt += hints.get(intent, "")
        
        headers = {
            "Authorization": f"Bearer {api_key}",
            "Content-Type": "application/json",
            "HTTP-Referer": "https://replit.com",
        }
        
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
        if intent in ["comparison", "biography"]:
            temp, tokens = 0.7, 1500
        elif intent == "recommendation":
            temp, tokens = 0.85, 1200
        else:
            temp, tokens = 0.8, 1200
        
        payload = {
            "model": MODEL,
            "messages": conversation,
            "system": system_prompt,
            "max_tokens": tokens,
            "temperature": temp,
            "top_p": 0.95,
        }
        
        response = requests.post(OPEN_ROUTER_API_URL, headers=headers, json=payload, timeout=30)
        response.raise_for_status()
        
        result = response.json()
        assistant_message = result["choices"][0]["message"]["content"]
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        conversation.append({"role": "assistant", "content": assistant_message})
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
        if len(assistant_message) > 4090:
            parts = [assistant_message[i:i+4090] for i in range(0, len(assistant_message), 4090)]
            for part in parts:
                await update.message.reply_text(part, parse_mode="Markdown")
        else:
            await update.message.reply_text(assistant_message, parse_mode="Markdown")
        
        # –ö–Ω–æ–ø–∫–∏
        keyboard = [
            [InlineKeyboardButton("‚ù§Ô∏è –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ", callback_data="add_favorite"),
             InlineKeyboardButton("üìù –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å", callback_data="copy_msg")]
        ]
        await update.message.reply_text("üí° –ü–æ–ª–µ–∑–Ω–æ?", reply_markup=InlineKeyboardMarkup(keyboard))
        
    except requests.exceptions.Timeout:
        await update.message.reply_text("‚è±Ô∏è –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ. –ü–æ–ø—Ä–æ–±—É–π –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–∏–π –≤–æ–ø—Ä–æ—Å.")
    except requests.exceptions.RequestException as e:
        logger.error(f"API Error: {e}")
        await update.message.reply_text("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ –∏–ª–∏ /clear")
    except Exception as e:
        logger.error(f"Error: {e}")
        await update.message.reply_text("üòï –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π /clear")

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫"""
    query = update.callback_query
    await query.answer()
    
    user_id = query.from_user.id
    data = get_user_data(user_id)
    
    if query.data == "add_favorite":
        if data["current_topic"]:
            if data["current_topic"] not in data["favorites"]:
                data["favorites"].append(data["current_topic"])
                await query.edit_message_text("‚ù§Ô∏è –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!")
            else:
                await query.edit_message_text("‚úÖ –£–∂–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º!")
    
    elif query.data == "show_favs":
        await show_favorites(update, context)
    elif query.data == "help_info":
        await help_command(update, context)
    elif query.data == "about_writer":
        await query.edit_message_text("‚úçÔ∏è –ù–∞–ø–∏—à–∏ –∏–º—è –ø–∏—Å–∞—Ç–µ–ª—è –∏–ª–∏ –≤–æ–ø—Ä–æ—Å –æ –Ω—ë–º!")

async def error_handler(update: object, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –±–æ—Ç–∞"""
    logger.error(f"Update {update} caused error {context.error}")

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    app = Application.builder().token(token).build()
    
    # –ö–æ–º–∞–Ω–¥—ã
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("help", help_command))
    app.add_handler(CommandHandler("clear", clear_history))
    app.add_handler(CommandHandler("stats", show_stats))
    app.add_handler(CommandHandler("favs", show_favorites))
    
    # Callback –∫–Ω–æ–ø–∫–∏
    app.add_handler(CallbackQueryHandler(button_handler))
    
    # –°–æ–æ–±—â–µ–Ω–∏—è
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
    app.add_error_handler(error_handler)
    
    logger.info("=" * 50)
    logger.info("üé≠ –õ–ò–¢–ï–†–ê–¢–£–†–ù–´–ô –ë–û–¢ v3.0 –ó–ê–ü–£–©–ï–ù!")
    logger.info(f"üìö –ú–æ–¥–µ–ª—å: {MODEL}")
    logger.info("üí´ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏ –∫—Ä–∞—Å–∏–≤—ã–π!")
    logger.info("=" * 50)
    
    app.run_polling(allowed_updates=["message", "callback_query"])

if __name__ == "__main__":
    main()
