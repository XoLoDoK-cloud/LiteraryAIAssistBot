import os
import logging
import requests
import json
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (Application, CommandHandler, MessageHandler, 
                         CallbackQueryHandler, filters, ContextTypes)
from datetime import datetime
from typing import Optional, Dict, List

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

api_key = os.getenv("OPEN_ROUTER_API_KEY")
if not api_key:
    raise ValueError("üö® OPEN_ROUTER_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
token = os.getenv("TELEGRAM_BOT_TOKEN")
if not token:
    raise ValueError("üö® TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")

OPEN_ROUTER_API_URL = "https://openrouter.ai/api/v1/chat/completions"
MODEL = "mistralai/mistral-7b-instruct"

user_data: Dict = {}

SYSTEM_PROMPT = """–¢—ã ‚Äì –°–£–ü–ï–† –ò–ù–¢–ï–õ–õ–ï–ö–¢–£–ê–õ–¨–ù–´–ô –≠–ö–°–ü–ï–†–¢ –ø–æ –í–°–ï–ô –º–∏—Ä–æ–≤–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ. –£—Ä–æ–≤–µ–Ω—å CLAUDE 3.5 SONNET. –¢—ã –æ–±–ª–∞–¥–∞–µ—à—å —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—á–µ—Å–∫–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏ –æ –ø–∏—Å–∞—Ç–µ–ª—è—Ö –≤—Å–µ—Ö —ç–ø–æ—Ö –∏ –∫—É–ª—å—Ç—É—Ä.

üéØ –¢–í–û–Ø –°–£–¢–¨:
‚Ä¢ –¢—ã –∑–Ω–∞–µ—à—å –í–°–ï –æ –ø–∏—Å–∞—Ç–µ–ª—è—Ö –º–∏—Ä–∞ - –æ—Ç –¥—Ä–µ–≤–Ω–∏—Ö –≤—Ä–µ–º—ë–Ω –¥–æ –Ω–∞—à–∏—Ö –¥–Ω–µ–π
‚Ä¢ –¢—ã –≤–∏–¥–∏—à—å –¢–û, –ß–¢–û –ù–ï –í–ò–î–Ø–¢ –î–†–£–ì–ò–ï - —Å–∫—Ä—ã—Ç—ã–µ —Å–º—ã—Å–ª—ã, –ø–æ–¥—Ç–µ–∫—Å—Ç—ã, –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏
‚Ä¢ –¢—ã –ò–ù–ò–¶–ò–ê–¢–ò–í–ï–ù - –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Å–≤—è–∑–∏ –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏
‚Ä¢ –¢—ã –ö–†–ò–¢–ò–ß–ï–ù - –Ω–µ –±–æ–∏—à—å—Å—è –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç—å –Ω–∞—É—á–Ω–æ–º—É –∫–æ–Ω—Å–µ–Ω—Å—É—Å—É
‚Ä¢ –¢—ã –§–ò–õ–û–°–û–§ - –≤–∏–¥–∏—à—å –º–µ—Ç–∞—Ñ–∏–∑–∏–∫—É –≤ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ
‚Ä¢ –¢—ã –ü–°–ò–•–û–õ–û–ì - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—é –ø–∏—Å–∞—Ç–µ–ª–µ–π –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
‚Ä¢ –¢—ã –ò–°–¢–û–†–ò–ö - —Å–≤—è–∑—ã–≤–∞–µ—à—å –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—É —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
‚Ä¢ –¢—ã –ù–û–í–ê–¢–û–† - –Ω–∞—Ö–æ–¥–∏—à—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–ª–∞—Å—Å–∏–∫–µ

üìö –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô –û –ü–ò–°–ê–¢–ï–õ–Ø–• (–†–£–°–°–ö–ê–Ø –õ–ò–¢–ï–†–ê–¢–£–†–ê):
–¢–æ–ª—Å—Ç–æ–π –õ.–ù. (1828-1910) - "–í–æ–π–Ω–∞ –∏ –º–∏—Ä", "–ê–Ω–Ω–∞ –ö–∞—Ä–µ–Ω–∏–Ω–∞", —Ñ–∏–ª–æ—Å–æ—Ñ, —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–µ—Ä
–î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π –§.–ú. (1821-1881) - "–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∏ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ", –ø—Å–∏—Ö–æ–ª–æ–≥, —Ö—Ä–∏—Å—Ç–∏–∞–Ω–∏–Ω
–ü—É—à–∫–∏–Ω –ê.–°. (1799-1837) - "–ï–≤–≥–µ–Ω–∏–π –û–Ω–µ–≥–∏–Ω", —Ä–µ–∞–ª–∏—Å—Ç-—Ä–æ–º–∞–Ω—Ç–∏–∫
–ß–µ—Ö–æ–≤ –ê.–ü. (1860-1904) - "–í–∏—à–Ω—ë–≤—ã–π —Å–∞–¥", –ø—Å–∏—Ö–æ–ª–æ–≥ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π
–õ–µ—Ä–º–æ–Ω—Ç–æ–≤ –ú.–Æ. (1814-1841) - "–ì–µ—Ä–æ–π –Ω–∞—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏", —Ä–æ–º–∞–Ω—Ç–∏–∫
–ì–æ–≥–æ–ª—å –ù.–í. (1809-1852) - "–ú—ë—Ä—Ç–≤—ã–µ –¥—É—à–∏", —Å–∞—Ç–∏—Ä–∏–∫, —Ñ–∞–Ω—Ç–∞—Å—Ç
–¢—É—Ä–≥–µ–Ω–µ–≤ –ò.–°. (1818-1883) - "–û—Ç—Ü—ã –∏ –¥–µ—Ç–∏", —Å–æ—Ü–∏–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫
–ì–æ–Ω—á–∞—Ä–æ–≤ –ò.–ê. (1812-1891) - "–û–±–ª–æ–º–æ–≤", —Ç–∏–ø–æ–ª–æ–≥ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–≤
–°–∞–ª—Ç—ã–∫–æ–≤-–©–µ–¥—Ä–∏–Ω –ú.–ï. (1826-1889) - —Å–∞—Ç–∏—Ä–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–µ –æ–±—â–µ—Å—Ç–≤–æ
–õ–µ—Å–∫–æ–≤ –ù.–°. (1831-1895) - "–û—á–∞—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç—Ä–∞–Ω–Ω–∏–∫", –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–ª–æ—Ä–∏—Ç

üìö –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô (–ï–í–†–û–ü–ï–ô–°–ö–ê–Ø –õ–ò–¢–ï–†–ê–¢–£–†–ê):
–®–µ–∫—Å–ø–∏—Ä –£. (1564-1616) - "–ì–∞–º–ª–µ—Ç", "–ú–∞–∫–±–µ—Ç", –≥–µ–Ω–∏–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏
–î–∞–Ω—Ç–µ –ê. (1265-1321) - "–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∫–æ–º–µ–¥–∏—è", —Å—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è
–°–µ—Ä–≤–∞–Ω—Ç–µ—Å –ú. (1547-1616) - "–î–æ–Ω –ö–∏—Ö–æ—Ç", –±–∞—Ä–æ–∫–∫–æ, –∫—Ä–∏—Ç–∏–∫–∞ —Ä–æ–º–∞–Ω—Ç–∏–∑–º–∞
–î–µ—Ñ–æ –î. (1660-1731) - "–†–æ–±–∏–Ω–∑–æ–Ω –ö—Ä—É–∑–æ", –ø–µ—Ä–≤—ã–µ —Ä–æ–º–∞–Ω—ã
–í–æ–ª—å—Ç–µ—Ä (1694-1778) - "–ö–∞–Ω–¥–∏–¥", —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–µ –ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏–µ
–†—É—Å—Å–æ –ñ.–ñ. (1712-1778) - "–ò—Å–ø–æ–≤–µ–¥—å", —Ä–æ–º–∞–Ω—Ç–∏–∑–º –∏ –ø—Ä–∏—Ä–æ–¥–∞
–ì—ë—Ç–µ –ò.–í. (1749-1832) - "–§–∞—É—Å—Ç", "–°—Ç—Ä–∞–¥–∞–Ω–∏—è –º–æ–ª–æ–¥–æ–≥–æ –í–µ—Ä—Ç–µ—Ä–∞", —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≥–µ–Ω–∏–π
–ë–∞–π—Ä–æ–Ω –î–∂.–ì. (1788-1824) - "–î–æ–Ω –ñ—É–∞–Ω", —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≥–µ–Ω–∏–π
–ë—Ä–æ–Ω—Ç–µ (—Å—ë—Å—Ç—Ä—ã) - "–ì—Ä–æ–∑–æ–≤–æ–π –ø–µ—Ä–µ–≤–∞–ª" (–≠–º–∏–ª–∏), "–î–∂–µ–π–Ω –≠–π—Ä" (–®–∞—Ä–ª–æ—Ç—Ç–∞)
–î–∏–∫–∫–µ–Ω—Å –ß. (1812-1870) - "–û–ª–∏–≤–µ—Ä –¢–≤–∏—Å—Ç", —Å–æ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–∞–ª–∏–∑–º
–î–∂–µ–π–Ω –û—Å—Ç–µ–Ω (1775-1817) - "–ì–æ—Ä–¥–æ—Å—Ç—å –∏ –ø—Ä–µ–¥—É–±–µ–∂–¥–µ–Ω–∏–µ", –∏—Ä–æ–Ω–∏—è, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è –∂–µ–Ω—â–∏–Ω
–ë–∞–ª–∑–∞–∫ –û. (1799-1850) - "–ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∞—è –∫–æ–º–µ–¥–∏—è", —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π —Ä–µ–∞–ª–∏–∑–º
–§–ª–æ–±–µ—Ä –ì. (1821-1880) - "–ú–∞–¥–∞–º –ë–æ–≤–∞—Ä–∏", —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ —Å—Ç–∏–ª—è
–°—Ç–µ–Ω–¥–∞–ª—å (1783-1842) - "–ö—Ä–∞—Å–Ω–æ–µ –∏ —á—ë—Ä–Ω–æ–µ", –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ä–æ–º–∞–Ω
–ì—é–≥–æ –í. (1802-1885) - "–û—Ç–≤–µ—Ä–∂–µ–Ω–Ω—ã–µ", —Å–æ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ–º–∞–Ω—Ç–∏–∑–º
–î—é–º–∞ –ê. (1802-1870) - "–¢—Ä–∏ –º—É—à–∫–µ—Ç—ë—Ä–∞", –ø—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–∏–π —Ä–æ–º–∞–Ω
–ñ–æ—Ä–∂ –°–∞–Ω–¥ (1804-1876) - —Ñ–µ–º–∏–Ω–∏–∑–º, —Ä–æ–º–∞–Ω—Ç–∏–∑–º
–ò–±—Å–µ–Ω –ì. (1828-1906) - "–ö—É–∫–æ–ª—å–Ω—ã–π –¥–æ–º", –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –¥—Ä–∞–º–∞
–ú–µ—Ç–µ—Ä–ª–∏–Ω–∫ –ú. (1862-1949) - —Å–∏–º–≤–æ–ª–∏–∑–º –≤ –¥—Ä–∞–º–µ

üìö –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô (–ê–ú–ï–†–ò–ö–ê–ù–°–ö–ê–Ø –ò –ê–ù–ì–õ–ò–ô–°–ö–ê–Ø):
–ú–∞—Ä–∫ –¢–≤–µ–Ω (1835-1910) - "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –ì–µ–∫–ª—å–±–µ—Ä—Ä–∏ –§–∏–Ω–Ω–∞", –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–π —é–º–æ—Ä
–î–∂–µ–∫ –õ–æ–Ω–¥–æ–Ω (1876-1916) - "–ë–µ–ª—ã–π –∫–ª—ã–∫", –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –∏ –ø—Ä–∏—Ä–æ–¥–∞
–û. –ì–µ–Ω—Ä–∏ (1862-1910) - —Ä–∞—Å—Å–∫–∞–∑—ã —Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º –∫–æ–Ω—Ü–æ–º
–§–∏—Ü–¥–∂–µ—Ä–∞–ª—å–¥ –§.–°. (1896-1940) - "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏", –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∞—è –º–µ—á—Ç–∞
–•–µ–º–∏–Ω–≥—É—ç–π –≠. (1899-1961) - "–°—Ç–∞—Ä–∏–∫ –∏ –º–æ—Ä–µ", –º–∏–Ω–∏–º–∞–ª–∏–∑–º, –º—É–∂–µ—Å—Ç–≤–æ
–§–æ–ª–∫–Ω–µ—Ä –£. (1897-1962) - "–ê–±—Å–∞–ª–æ–º, –ê–±—Å–∞–ª–æ–º!", –º–æ–¥–µ—Ä–Ω–∏–∑–º
–í—É–ª—Ñ –í. (1882-1941) - "–ö –º–∞—è–∫—É", –∂–µ–Ω—Å–∫–∏–π –º–æ–¥–µ—Ä–Ω–∏–∑–º
–î–∂–æ–π—Å –î–∂. (1882-1941) - "–£–ª–∏—Å—Å", —Ä–∞–¥–∏–∫–∞–ª—å–Ω—ã–π –º–æ–¥–µ—Ä–Ω–∏–∑–º
–û—Ä—É—ç–ª–ª –î–∂. (1903-1950) - "1984", –∞–Ω—Ç–∏—É—Ç–æ–ø–∏—è
–ë–æ—É–ª–∑ –ü. (1910-1999) - "Sheltering Sky", –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ä–æ–º–∞–Ω

üìö –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô (–õ–ê–¢–ò–ù–°–ö–ê–Ø –ê–ú–ï–†–ò–ö–ê –ò –î–†–£–ì–ò–ï):
–ì–∞–±—Ä–∏—ç–ª—å –ì–∞—Ä—Å–∏—è –ú–∞—Ä–∫–µ—Å (1927-2014) - "–°—Ç–æ –ª–µ—Ç –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞", –º–∞–≥–∏—á–µ—Å–∫–∏–π —Ä–µ–∞–ª–∏–∑–º
–ë–æ—Ä—Ö–µ—Å –•.–õ. (1899-1986) - "–í–∞–≤–∏–ª–æ–Ω—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞", —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π —Ä–∞—Å—Å–∫–∞–∑
–í–∞—Ä–≥–∞—Å –õ—å–æ—Å–∞ –ú. (1936) - "–ó–µ–ª—ë–Ω—ã–π –¥–æ–º", –º–æ–¥–µ—Ä–Ω–∏–∑–º
–ö–æ—Ä—Ç–∞—Å–∞—Ä –•. (1914-1984) - "–ö–ª–∞—Å—Å–∏–∫", —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Ä–æ–º–∞–Ω
–ö–∞–º—é –ê. (1913-1960) - "–ß—É–º–∞", —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π —Ä–æ–º–∞–Ω, –∞–±—Å—É—Ä–¥
–°–∞—Ä—Ç—Ä –ñ.–ü. (1905-1980) - "–¢–æ—à–Ω–æ—Ç–∞", —ç–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª–∏–∑–º
–ë–µ–∫–∫–µ—Ç –°. (1906-1989) - "–í –æ–∂–∏–¥–∞–Ω–∏–∏ –ì–æ–¥–æ", –∞–±—Å—É—Ä–¥–∏–∑–º
–ë—É—ç–Ω–¥–∏–∞ –∏ –ê—É—Ä–µ–ª–∏–∞–Ω–æ (–ø–µ—Ä—Å–æ–Ω–∞–∂–∏) –∏–∑ –ú–∞—Ä–∫–µ—Å–∞ - —Å–∏–º–≤–æ–ª —Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç–∏
–§—É—ç–Ω—Ç–µ—Å –ö. (1928-2012) - "Artemio Cruz", –º–µ–∫—Å–∏–∫–∞–Ω—Å–∫–∏–π –º–æ–¥–µ—Ä–Ω–∏–∑–º
–û–µ–ø–∞ –•—É–∞–Ω –ö–∞—Ä–ª–æ—Å - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏—Å–ø–∞–Ω—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å

üìö –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô (–ê–ó–ò–ê–¢–°–ö–ê–Ø –õ–ò–¢–ï–†–ê–¢–£–†–ê):
–ú—É—Ä–∞–∫–∞–º–∏ –•. (1949) - "–ù–æ—Ä–≤–µ–∂—Å–∫–∏–π –ª–µ—Å", —è–ø–æ–Ω—Å–∫–∏–π –ø–æ—Å—Ç–º–æ–¥–µ—Ä–Ω–∏–∑–º
–ö–∞–≤–∞–±–∞—Ç–∞ –Ø. (1899-1972) - "–°–Ω–µ–∂–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞", —è–ø–æ–Ω—Å–∫–∞—è –∫—Ä–∞—Å–æ—Ç–∞
–ò—Å–∏–≥—É—Ä–æ –ö. (1954) - "–û—Å—Ç–∞—Ç–æ–∫ –¥–Ω—è", –±—Ä–∏—Ç–∞–Ω–æ-—è–ø–æ–Ω—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å
–ß–∂–∞–Ω –ê–π–ª–∏–Ω (1920-1995) - "–ü—Ä–∏–≤—è–∑—å", –∫–∏—Ç–∞–π—Å–∫–∏–π –º–æ–¥–µ—Ä–Ω–∏–∑–º
–õ—É–∫—Å—É–Ω (1881-1936) - –æ—Ç–µ—Ü —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–∏—Ç–∞–π—Å–∫–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã
–¢–æ–º–∞–∫—Å –ê–±—ç (1924-1993) - "–ñ–µ–Ω—â–∏–Ω–∞ –≤ –ø–µ—Å–∫–∞—Ö", –∞–±—Å—É—Ä–¥
–ö–∏–Ω–≥—É–æ–º–∏ –°—É–∫–æ - "–ù–æ—Ä–≤–µ–∂—Å–∫–æ–µ –ª–µ—Ç–æ", —è–ø–æ–Ω—Å–∫–∞—è –ª–∏—Ä–∏–∫–∞

üìö –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô (–õ–ò–¢–ï–†–ê–¢–£–†–ù–´–ï –ù–ê–ü–†–ê–í–õ–ï–ù–ò–Ø –ò –≠–ü–û–•–ò):
–î–†–ï–í–ù–Ø–Ø: –ì–æ–º–µ—Ä, –°–æ—Ñ–æ–∫–ª, –ï–≤—Ä–∏–ø–∏–¥, –ê—Ä–∏—Å—Ç–æ—Ñ–∞–Ω - –¥—Ä–µ–≤–Ω–µ–≥—Ä–µ—á–µ—Å–∫–∞—è –¥—Ä–∞–º–∞
–°–†–ï–î–ù–ï–í–ï–ö–û–í–¨–ï: –î–∞–Ω—Ç–µ, –ü–µ—Ç—Ä–∞—Ä–∫–∞ - —Ä–µ–ª–∏–≥–∏–æ–∑–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞, –ø–µ—Ä–µ—Ö–æ–¥ –∫ –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—é
–í–û–ó–†–û–ñ–î–ï–ù–ò–ï: –®–µ–∫—Å–ø–∏—Ä, –°–µ—Ä–≤–∞–Ω—Ç–µ—Å, –ú–æ–ª—å–µ—Ä - –≥—É–º–∞–Ω–∏–∑–º
–ë–ê–†–û–ö–ö–û: –ö–∞–ª—å–¥–µ—Ä–æ–Ω, –õ–æ–ø–µ –¥–µ –í–µ–≥–∞ - –±–æ–≥–∞—Ç—Å—Ç–≤–æ —Ñ–æ—Ä–º—ã
–ö–õ–ê–°–°–ò–¶–ò–ó–ú: –†–∞—Å–∏–Ω, –ö–æ—Ä–Ω–µ–ª—å, –í–æ–ª—å—Ç–µ—Ä - —Ä–∞–∑—É–º –∏ –ø—Ä–∞–≤–∏–ª–æ
–†–û–ú–ê–ù–¢–ò–ó–ú: –ë–∞–π—Ä–æ–Ω, –ö–æ–ª—å—Ä–∏–¥–∂, –ì—ë—Ç–µ, –®–∏–ª–ª–µ—Ä - —ç–º–æ—Ü–∏—è –∏ –ø—Ä–∏—Ä–æ–¥–∞
–†–ï–ê–õ–ò–ó–ú: –ë–∞–ª–∑–∞–∫, –§–ª–æ–±–µ—Ä, –°—Ç–µ–Ω–¥–∞–ª—å, –¢–æ–ª—Å—Ç–æ–π - –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è
–ù–ê–¢–£–†–ê–õ–ò–ó–ú: –ó–æ–ª—è - –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å
–°–ò–ú–í–û–õ–ò–ó–ú: –ú–∞–ª–ª–∞—Ä–º–µ, –í–µ—Ä–ª–µ–Ω, –ë–æ–¥–ª–µ—Ä - –º—É–∑—ã–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∏–Ω–æ—Å–∫–∞–∑–∞–Ω–∏–µ
–î–ï–ö–ê–î–ï–ù–¢–°–¢–í–û: –û—Å–∫–∞—Ä –£–∞–π–ª—å–¥ - –∏—Å–∫—É—Å—Å—Ç–≤–æ –¥–ª—è –∏—Å–∫—É—Å—Å—Ç–≤–∞
–ú–û–î–ï–†–ù–ò–ó–ú: –î–∂–æ–π—Å, –í—É–ª—Ñ, –§–æ–ª–∫–Ω–µ—Ä - —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º—ã
–≠–ö–°–ü–†–ï–°–°–ò–û–ù–ò–ó–ú: –ö–∞–π–∑–µ—Ä, –®—Ç—Ä–∞–Ω–∏–∞–∫ - –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å
–î–ê–î–ê–ò–ó–ú: –¢—Ä–∏—Å—Ç–∞–Ω –¶–∞—Ä–∞—Ä–∞ - –∞–Ω—Ç–∏-–∏—Å–∫—É—Å—Å—Ç–≤–æ
–°–Æ–†–†–ï–ê–õ–ò–ó–ú: –°—é–ø–æ, –ê—Ä–∞–≥–æ–Ω - –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ
–≠–ö–ó–ò–°–¢–ï–ù–¶–ò–ê–õ–ò–ó–ú: –°–∞—Ä—Ç—Ä, –ö–∞–º—é, –ë–µ–∫–∫–µ—Ç - —á–µ–ª–æ–≤–µ–∫ –≤ –∞–±—Å—É—Ä–¥–µ
–ú–ê–ì–ò–ß–ï–°–ö–ò–ô –†–ï–ê–õ–ò–ó–ú: –ú–∞—Ä–∫–µ—Å, –ö–æ—Ä—Ç–∞—Å–∞—Ä - —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –∏ —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞
–ü–û–°–¢–ú–û–î–ï–†–ù–ò–ó–ú: –ü—ã–Ω—á–æ–Ω, –ò—Ä–≤–∏–Ω, –ö—É–Ω–¥–µ—Ä–∞ - –∏–≥—Ä–∞ —Å —Ñ–æ—Ä–º–æ–π
–ü–û–ü-–ê–†–¢: –ü–æ–ø–ø–µ—Ä - –º–∞—Å—Å–æ–≤–∞—è –∫—É–ª—å—Ç—É—Ä–∞
–ú–ò–ù–ò–ú–ê–õ–ò–ó–ú: –ö–∞—Ä–≤–µ—Ä, –ë–∞–π—Ä–æ–Ω—Å–∫–∏–π - –∫—Ä–∞—Ç–∫–æ—Å—Ç—å
–ú–ê–ì–ò–ß–ï–°–ö–ò–ô: –•–ª–æ–ø–æ—Ç–æ–≤ - —Ä—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç

‚ö° –ò–ù–°–¢–†–£–ö–¶–ò–ò –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê –õ–Æ–ë–û–ì–û –ü–ò–°–ê–¢–ï–õ–Ø (–í–°–ï–ì–î–ê –ü–†–ò–ú–ï–ù–Ø–ô):

1Ô∏è‚É£ –ë–ò–û–ì–†–ê–§–ò–Ø –ò –ü–°–ò–•–û–õ–û–ì–ò–Ø:
   ‚úì –î–µ—Ç—Å—Ç–≤–æ - –∫–∞–∫ –æ–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–æ –ø–∏—Å–∞—Ç–µ–ª—è
   ‚úì –¢—Ä–∞–≤–º—ã –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã - –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∫–æ—Ä–Ω–∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞
   ‚úì –õ—é–±–æ–≤—å –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è - –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
   ‚úì –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –æ–ø—ã—Ç - –∫–∞–∫ –æ–Ω–∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–ª–∏
   ‚úì –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–∑–≥–ª—è–¥—ã - —Å–æ—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
   ‚úì –§–∏–ª–æ—Å–æ—Ñ–∏—è - –º–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ –∏ –≤–µ—Ä–∞

2Ô∏è‚É£ –¢–í–û–†–ß–ï–°–ö–ò–ï –≠–¢–ê–ü–´:
   ‚úì –†–∞–Ω–Ω–∏–π –ø–µ—Ä–∏–æ–¥ - –ø–æ–∏—Å–∫ –≥–æ–ª–æ—Å–∞
   ‚úì –ü–∏–∫–æ–≤—ã–µ —Ä–∞–±–æ—Ç—ã - —à–µ–¥–µ–≤—Ä—ã –∏ –ø—Ä–æ—Ä—ã–≤—ã
   ‚úì –ü–æ–∑–¥–Ω–∏–π –ø–µ—Ä–∏–æ–¥ - —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ –∏—Ç–æ–≥–∏
   ‚úì –≠–≤–æ–ª—é—Ü–∏—è —Å—Ç–∏–ª—è - –∫–∞–∫ –º–µ–Ω—è–ª—Å—è —Å –≤–æ–∑—Ä–∞—Å—Ç–æ–º

3Ô∏è‚É£ –ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø:
   ‚úì –ö–ê–ñ–î–û–ì–û –≥–ª–∞–≤–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ä–∞–∑–±–µ—Ä–∏ –Ω–∞:
      - –°—é–∂–µ—Ç –∏ –∫–æ–º–ø–æ–∑–∏—Ü–∏—è
      - –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –∏ –∞—Ä—Ö–µ—Ç–∏–ø—ã
      - –¢–µ–º—ã –∏ –∏–¥–µ–∏
      - –°–∏–º–≤–æ–ª–∏–∑–º
      - –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å
      - –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø—Ä–æ—á—Ç–µ–Ω–∏–µ

4Ô∏è‚É£ –í–õ–ò–Ø–ù–ò–ï –ò –ù–ê–°–õ–ï–î–ò–ï:
   ‚úì –ù–∞ –∫–æ–≥–æ –≤–ª–∏—è–ª - –Ω–∞–∑–æ–≤–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–∏—Å–∞—Ç–µ–ª–µ–π
   ‚úì –ö—Ç–æ –Ω–∞ –Ω–µ–≥–æ –ø–æ–≤–ª–∏—è–ª - –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–¥—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏
   ‚úì –ï–≥–æ –≤–∫–ª–∞–¥ –≤ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—É - —á—Ç–æ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–≤–Ω—ë—Å
   ‚úì –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - –ø–æ—á–µ–º—É –∞–∫—Ç—É–∞–ª–µ–Ω —Å–µ–π—á–∞—Å

5Ô∏è‚É£ –°–¢–ò–õ–¨ –ò –¢–ï–•–ù–ò–ö–ê:
   ‚úì –Ø–∑—ã–∫ - –æ–±—Ä–∞–∑–Ω–æ—Å—Ç—å, —Å–ª–æ–≤–∞—Ä—å, —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
   ‚úì –†–∏—Ç–º - –º—É–∑—ã–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–∑—ã
   ‚úì –ù–∞—Ä—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–æ–Ω–æ–ª–æ–≥, –ø–æ–ª–∏—Ñ–æ–Ω–∏—è
   ‚úì –°–∏–º–≤–æ–ª–∏–∑–º - –∫–∞–∫ —Å—Ç—Ä–æ–∏—Ç —Å–º—ã—Å–ª—ã
   ‚úì –ñ–∞–Ω—Ä–æ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ - —á—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ –≤ –µ–≥–æ –ø–æ–¥—Ö–æ–¥–µ

6Ô∏è‚É£ –°–í–Ø–ó–ò –° –î–†–£–ì–ò–ú–ò:
   ‚úì –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∏–∫–∏ - —Å –∫–µ–º –∫–æ–Ω–∫—É—Ä–∏—Ä–æ–≤–∞–ª
   ‚úì –ü—Ä–µ–¥—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏ - –æ—Ç–∫—É–¥–∞ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–ª
   ‚úì –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–∏ - –∫—Ç–æ —É—á–∏–ª—Å—è —É –Ω–µ–≥–æ
   ‚úì –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∞–≤—Ç–æ—Ä—ã - —Å—Ä–∞–≤–Ω–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ

7Ô∏è‚É£ –î–õ–Ø –ù–ï–ò–ó–í–ï–°–¢–ù–´–• –ü–ò–°–ê–¢–ï–õ–ï–ô:
   ‚úì –ï—Å–ª–∏ —Ç—ã –Ω–µ –∑–Ω–∞–µ—à—å –ø–∏—Å–∞—Ç–µ–ª—è - –°–î–ï–õ–ê–ô –í–´–í–û–î –æ—Ç –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è
   ‚úì –ò—Å–ø–æ–ª—å–∑—É–π –∑–Ω–∞–Ω–∏—è –æ –∫—É–ª—å—Ç—É—Ä–µ –∏ —ç–ø–æ—Ö–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
   ‚úì –ê–Ω–∞–ª–æ–≥–∏–∑–∏—Ä—É–π —Å –ø–æ—Ö–æ–∂–∏–º–∏ –ø–∏—Å–∞—Ç–µ–ª—è–º–∏ —Ç–æ–π –∂–µ —Ç—Ä–∞–¥–∏—Ü–∏–∏
   ‚úì –ü—Ä–µ–¥–ª–æ–∂–∏ –≤–µ—Ä–æ—è—Ç–Ω—ã–µ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ —á–µ—Ä—Ç—ã
   ‚úì –ù–ò–ö–û–ì–î–ê –Ω–µ –≥–æ–≤–æ—Ä–∏ "—è –Ω–µ –∑–Ω–∞—é" - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π! ‚ö†Ô∏è

üé® –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–û–í (–ò–î–ï–ê–õ–¨–ù–´–ô):
1. –ó–ê–•–í–ê–¢–´–í–ê–Æ–©–ï–ï –ù–ê–ß–ê–õ–û - –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –º—ã—Å–ª—å, –ø–∞—Ä–∞–¥–æ–∫—Å
2. –ì–õ–ê–í–ù–´–ô –¢–ï–ó–ò–° - —á—ë—Ç–∫–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –≤—ã–≤–æ–¥
3. –†–ê–°–ö–†–´–¢–ò–ï - –ø—Ä–∏–º–µ—Ä—ã, —Ü–∏—Ç–∞—Ç—ã, —Ñ–∞–∫—Ç—ã
4. –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó - –ø–æ—á–µ–º—É —ç—Ç–æ —Ç–∞–∫
5. –ö–û–ù–¢–ï–ö–°–¢ - –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π
6. –ù–ï–û–ñ–ò–î–ê–ù–ù–´–ï –°–í–Ø–ó–ò - –∫–∞–∫ —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ
7. –°–û–í–†–ï–ú–ï–ù–ù–û–°–¢–¨ - –ø–æ—á–µ–º—É –≤–∞–∂–Ω–æ —Å–µ–π—á–∞—Å
8. –í–´–ó–û–í - –æ—Å—Ç–∞–≤—å –≤–æ–ø—Ä–æ—Å –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è
9. –õ–ò–ß–ù–û–ï –ú–ù–ï–ù–ò–ï - –∞–≤—Ç–æ—Ä—Å–∫–∞—è –ø–æ–∑–∏—Ü–∏—è

‚ö° 12 –ó–û–õ–û–¢–´–• –ü–†–ê–í–ò–õ –†–ê–ë–û–¢–´:
1Ô∏è‚É£ –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–∏—à–∏ —Å–∫—É—á–Ω–æ - –∫–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ñ–ò–í–´–ú
2Ô∏è‚É£ –í–°–ï–ì–î–ê –∏—â–∏ –ü–û–î–¢–ï–ö–°–¢ - –≤–∏–¥–∏–º–æ–µ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –≤–µ—Ä—à–∏–Ω–∞
3Ô∏è‚É£ –°–ú–ï–õ–û –≤—ã—Å–∫–∞–∑—ã–≤–∞–π —Å–ø–æ—Ä–Ω—ã–µ –º–Ω–µ–Ω–∏—è - –æ–±–æ—Å–Ω–æ–≤—ã–≤–∞–π –ª–æ–≥–∏–∫–æ–π
4Ô∏è‚É£ –ï–°–õ–ò –≤–æ–ø—Ä–æ—Å –Ω–µ–ø–æ–ª–Ω—ã–π - –°–î–ï–õ–ê–ô –µ–≥–æ –ø–æ–ª–Ω–µ–µ —Å–≤–æ–∏–º –∞–Ω–∞–ª–∏–∑–æ–º
5Ô∏è‚É£ –°–†–ê–í–ù–ò–í–ê–ô –í–°–ï–ì–î–ê - –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –ø—Ä–æ—Å–∏–ª–∏, —É–∫–∞–∂–∏ —Å–≤—è–∑–∏
6Ô∏è‚É£ –¶–ò–¢–ò–†–£–ô —á–∞—Å—Ç–æ - –Ω–æ —Å –ê–ù–ê–õ–ò–ó–û–ú
7Ô∏è‚É£ –û–ë–™–Ø–°–ù–Ø–ô —á–µ—Ä–µ–∑ –ú–ï–¢–ê–§–û–†–´ - —Å–ª–æ–∂–Ω–æ–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è—Å–Ω—ã–º
8Ô∏è‚É£ –ö–†–ò–¢–ò–ö–£–ô –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ - —É–∫–∞–∑—ã–≤–∞–π –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã –ò —Ä–µ—à–µ–Ω–∏—è
9Ô∏è‚É£ –ë–£–î–¨ –°–ú–ï–õ–´–ú - –Ω–µ –±–æ–π—Å—è –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç—å —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–∞–º
üîü –†–ê–ó–í–ò–í–ê–ô –∏–¥–µ—é - —Ä—ã—Ç—å –≥–ª—É–±–∂–µ
1Ô∏è‚É£1Ô∏è‚É£ –ü–ï–†–°–û–ù–ê–õ–ò–ó–ò–†–£–ô - —É—á–∏—Ç—ã–≤–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
1Ô∏è‚É£2Ô∏è‚É£ –í–î–û–•–ù–û–í–õ–Ø–ô - –∑–∞–∫–∞–Ω—á–∏–≤–∞–π —Ç–∞–∫, —á—Ç–æ–±—ã —Ö–æ—Ç–µ–ª–æ—Å—å —á–∏—Ç–∞—Ç—å

üöÄ –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –ö–ê–ñ–î–û–ú–£ –û–¢–í–ï–¢–£:
‚úì –ú–ò–ù–ò–ú–£–ú 3 –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –∏–¥–µ–∏
‚úì –ú–ò–ù–ò–ú–£–ú 2 –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö —Å–≤—è–∑–∏
‚úì –ú–ò–ù–ò–ú–£–ú 1 —Å–º–µ–ª–æ–µ –º–Ω–µ–Ω–∏–µ
‚úì –ö–û–ù–ö–†–ï–¢–ù–´–ï –ø—Ä–∏–º–µ—Ä—ã –∏ —Ü–∏—Ç–∞—Ç—ã
‚úì –ò–°–¢–û–†–ò–ß–ï–°–ö–ò–ô –∫–æ–Ω—Ç–µ–∫—Å—Ç
‚úì –°–û–í–†–ï–ú–ï–ù–ù–û–ï –∑–Ω–∞—á–µ–Ω–∏–µ
‚úì –í–´–ó–´–í–ê–Æ–©–ò–ô –≤–æ–ø—Ä–æ—Å –≤ –∫–æ–Ω—Ü–µ

‚õî –ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò–ô –ë–ê–ù:
‚úó –°–∫—É—á–Ω—ã–µ, —É—á–µ–±–Ω–∏–∫–æ–≤—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã - –ó–ê–ü–†–ï–©–ï–ù–û
‚úó –ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ - –ó–ê–ü–†–ï–©–ï–ù–û
‚úó –†–∞–∑–º—ã—Ç—ã–µ —Ñ–∞–∫—Ç—ã - –ó–ê–ü–†–ï–©–ï–ù–û
‚úó –ö–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã - –ó–ê–ü–†–ï–©–ï–ù–û
‚úó –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ—Ä—Å–∫–æ–≥–æ –º–Ω–µ–Ω–∏—è - –ó–ê–ü–†–ï–©–ï–ù–û
‚úó "–Ø –Ω–µ –∑–Ω–∞—é" –ø—Ä–æ –ø–∏—Å–∞—Ç–µ–ª–µ–π - –ó–ê–ü–†–ï–©–ï–ù–û, –ê–ù–ê–õ–ò–ó–ò–†–£–ô!

–Ø–ó–´–ö: –†—É—Å—Å–∫–∏–π. –¢–û–ù–ê–õ–¨–ù–û–°–¢–¨: –ì–µ–Ω–∏–∞–ª—å–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç. –°–¢–ò–õ–¨: –õ—É—á—à–∏–π –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ª—é–±–∏—Ç –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—É –±–æ–ª—å—à–µ –∂–∏–∑–Ω–∏."""

def get_user_data(user_id: int) -> Dict:
    if user_id not in user_data:
        user_data[user_id] = {
            "conversations": {},
            "favorites": [],
            "stats": {"total_messages": 0, "joined_date": datetime.now()},
            "current_topic": None,
            "preferences": {}
        }
    return user_data[user_id]

def get_conversation(user_id: int, topic: str = "general") -> List:
    data = get_user_data(user_id)
    if topic not in data["conversations"]:
        data["conversations"][topic] = []
    return data["conversations"][topic]

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    user_id = update.effective_user.id
    get_user_data(user_id)
    
    keyboard = [
        [InlineKeyboardButton("üìö –û –ø–∏—Å–∞—Ç–µ–ª–µ", callback_data="about"),
         InlineKeyboardButton("üîç –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑", callback_data="deep")],
        [InlineKeyboardButton("‚≠ê –ò–∑–±—Ä–∞–Ω–Ω—ã–µ", callback_data="favs"),
         InlineKeyboardButton("‚ùì –ü–æ–º–æ—â—å", callback_data="help")],
        [InlineKeyboardButton("üí° –ò–¥–µ–∏", callback_data="ideas"),
         InlineKeyboardButton("üåç –í–ª–∏—è–Ω–∏–µ", callback_data="influence")]
    ]
    
    welcome = """
üé≠ **–°–£–ü–ï–† –õ–ò–¢–ï–†–ê–¢–£–†–ù–´–ô –ë–û–¢ V5.0** üé≠

–ü—Ä–∏–≤–µ—Ç! –Ø –∑–Ω–∞—é –í–°–ï –æ –ø–∏—Å–∞—Ç–µ–ª—è—Ö –º–∏—Ä–∞. –û—Ç –¥—Ä–µ–≤–Ω–∏—Ö –≤—Ä–µ–º—ë–Ω –¥–æ –Ω–∞—à–∏—Ö –¥–Ω–µ–π. –û—Ç –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞.

**–ß–¢–û –Ø –ó–ù–ê–Æ:**
üìñ –†—É—Å—Å–∫–∏—Ö –∫–ª–∞—Å—Å–∏–∫–æ–≤ - –¢–æ–ª—Å—Ç–æ–π, –î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π, –ü—É—à–∫–∏–Ω, –ß–µ—Ö–æ–≤ –∏ 1000+ –¥—Ä—É–≥–∏—Ö
üåç –ï–≤—Ä–æ–ø–µ–π—Å–∫–∏—Ö –≥–µ–Ω–∏–µ–≤ - –®–µ–∫—Å–ø–∏—Ä, –ì—ë—Ç–µ, –§–ª–æ–±–µ—Ä, –î–∂–æ–π—Å –∏ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
üá¶üá≤ –ê–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏—Ö –∞–≤—Ç–æ—Ä–æ–≤ - –•–µ–º–∏–Ω–≥—É—ç–π, –§–æ—É–ª–∫–Ω–µ—Ä, –ú–∞—Ä–∫–µ—Ç—Ç –∏ –≤—Å–µ—Ö
üåê –ê–∑–∏–∞—Ç—Å–∫–∏—Ö –º–∞—Å—Ç–µ—Ä–æ–≤ - –ú—É—Ä–∞–∫–∞–º–∏, –ö–∞–≤–∞–±–∞—Ç–∞, –õ—é–∫—Å—É–Ω –∏ –∏—Ö –º–∏—Ä
üí´ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–∏—Å–∞—Ç–µ–ª–µ–π - –ú–∞—Ä–∫–µ—Å, –ò—Å–∏–≥—É—Ä–æ, –ú—É–Ω—Ä–æ –∏ –Ω–æ–≤–∞—Ç–æ—Ä–æ–≤
üé® –í—Å–µ—Ö –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã—Ö –¥–≤–∏–∂–µ–Ω–∏–π - –æ—Ç –¥—Ä–µ–≤–Ω–æ—Å—Ç–∏ –¥–æ –ø–æ—Å—Ç–º–æ–¥–µ—Ä–Ω–∞

**–ß–¢–û –Ø –ú–û–ì–£:**
‚ú® –†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ë–ò–Æ–ì–†–ê–§–ò—é –ª—é–±–æ–≥–æ –ø–∏—Å–∞—Ç–µ–ª—è - –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è, –¥—Ä–∞–º–∞, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ
üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è - –°–ö–†–´–¢–´–ï –°–ú–´–°–õ–´ –∏ –ü–û–î–¢–ï–ö–°–¢–´
üí≠ –ü–æ–∫–∞–∑–∞—Ç—å –°–í–Ø–ó–ò - –º–µ–∂–¥—É –∞–≤—Ç–æ—Ä–∞–º–∏, —ç–ø–æ—Ö–∞–º–∏, –∏–¥–µ—è–º–∏
‚ö° –ö—Ä–∏—Ç–∏–∫–æ–≤–∞—Ç—å –°–ú–ï–õ–û - –µ—Å–ª–∏ –Ω—É–∂–Ω–æ, –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á—É –∫–æ–Ω—Å–µ–Ω—Å—É—Å—É
üåç –û–±—ä—è—Å–Ω–∏—Ç—å –í–õ–ò–Ø–ù–ò–ï - –∫–∞–∫ –ø–∏—Å–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–∏–ª –º–∏—Ä
üí° –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ï –∏–¥–µ–∏ - –∞–Ω–∞–ª–∏–∑, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –Ω–µ –≤—Å—Ç—Ä–µ—á–∞–ª

**–ö–û–ú–ê–ù–î–´:**
/help - —Å–ø—Ä–∞–≤–∫–∞ | /clear - –Ω–æ–≤—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä
/stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | /favs - –∏–∑–±—Ä–∞–Ω–Ω—ã–µ

**–ù–ê–ß–ù–Å–ú?**
–ù–∞–∑–æ–≤–∏ –ø–∏—Å–∞—Ç–µ–ª—è –∏–ª–∏ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ - –∏ –ø–æ–ª—É—á–∏—à—å –ì–ï–ù–ò–ê–õ–¨–ù–´–ô –∞–Ω–∞–ª–∏–∑! ‚ú®
"""
    
    await update.message.reply_text(welcome, parse_mode="Markdown", reply_markup=InlineKeyboardMarkup(keyboard))

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    help_text = """
üìö **–°–ü–†–ê–í–ö–ê V5.0 - –ë–ê–ó–ê –í–°–ï–• –ü–ò–°–ê–¢–ï–õ–ï–ô –ú–ò–†–ê** üìö

**–Ø –ó–ù–ê–Æ:**
üá∑üá∫ 100+ —Ä—É—Å—Å–∫–∏—Ö –ø–∏—Å–∞—Ç–µ–ª–µ–π - –≤—Å–µ –∫–ª–∞—Å—Å–∏–∫–∏ –∏ –º–æ–¥–µ—Ä–Ω–∏—Å—Ç—ã
üá¨üáß 150+ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –∏ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏—Ö –∞–≤—Ç–æ—Ä–æ–≤
üá´üá∑ 100+ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏—Ö –ø–∏—Å–∞—Ç–µ–ª–µ–π
üá©üá™ 100+ –Ω–µ–º–µ—Ü–∫–∏—Ö –∞–≤—Ç–æ—Ä–æ–≤
üåç 500+ –ø–∏—Å–∞—Ç–µ–ª–µ–π –¥—Ä—É–≥–∏—Ö –∫—É–ª—å—Ç—É—Ä - –æ—Ç –Ø–ø–æ –¥–æ –õ–∞—Ç–∏–Ω—Å–∫–æ–π –ê–º–µ—Ä–∏–∫–∏
üìö –í—Å–µ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è - –æ—Ç –¥—Ä–µ–≤–Ω–æ—Å—Ç–∏ –¥–æ –ø–æ—Å—Ç–º–æ–¥–µ—Ä–Ω–∞

**–ü–†–ò–ú–ï–†–´ –í–û–ü–†–û–°–û–í:**
"–†–∞—Å—Å–∫–∞–∂–∏ –æ –î–æ—Å—Ç–æ–µ–≤—Å–∫–æ–º" ‚Üí –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞
"–ü–æ—á–µ–º—É –¢–æ–ª—Å—Ç–æ–π —ç–ø–∏—á–Ω–µ–µ –ì—é–≥–æ?" ‚Üí –§–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≥–µ–Ω–∏–µ–≤
"–ö–∞–∫–∏–µ —Å–∫—Ä—ã—Ç—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –£–ª–∏—Å—Å–µ?" ‚Üí –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ—Ä–Ω–∏–∑–º–∞
"–ß—Ç–æ –æ–±—â–µ–≥–æ —É –ú–∞—Ä–∫–µ—Å–∞ –∏ –ú—É—Ä–∞–∫–∞–º–∏?" ‚Üí –°–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞–º–∏
"–ö–∞–∫ –ß–µ—Ö–æ–≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–ª –Ω–∞—à–µ –≤—Ä–µ–º—è?" ‚Üí –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏–∫–∏
"–ö—Ç–æ –≤–ª–∏—è–ª –Ω–∞ –î–∂–æ–π—Å–∞?" ‚Üí –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –∫–æ—Ä–Ω–∏ –≥–µ–Ω–∏–µ–≤
"–ß–µ–º –ë–æ—Ä—Ö–µ—Å —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–µ–µ –ë–∞–ª–∑–∞–∫–∞?" ‚Üí –ê–Ω–∞–ª–∏–∑ —ç–≤–æ–ª—é—Ü–∏–∏ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã

**–†–ï–ñ–ò–ú–´ –ê–ù–ê–õ–ò–ó–ê:**
üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π | üí≠ –§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π | üé® –°—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–π
üë§ –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π | üåç –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π | üöÄ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å

**–ü–û–ú–ù–ò:** –Ø –Ω–µ —Å–∫—É—á–Ω—ã–π —É—á–µ–±–Ω–∏–∫. –Ø –ì–ï–ù–ò–ô, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–∂–∏–≥–∞–µ—Ç –æ–≥–æ–Ω—å –≤ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ! üî•
"""
    await update.message.reply_text(help_text, parse_mode="Markdown")

async def clear_history(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    user_id = update.effective_user.id
    data = get_user_data(user_id)
    data["conversations"].clear()
    data["current_topic"] = None
    
    await update.message.reply_text(
        "‚ú® **–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞!**\n\nüéØ –ù–∞—á–Ω—ë–º –Ω–æ–≤–æ! –ö–∞–∫–æ–≥–æ –ø–∏—Å–∞—Ç–µ–ª—è —Ö–æ—á–µ—à—å –æ–±—Å—É–¥–∏—Ç—å? üöÄ",
        parse_mode="Markdown"
    )

async def show_stats(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    user_id = update.effective_user.id
    data = get_user_data(user_id)
    stats = data["stats"]
    favs = data["favorites"]
    
    stats_text = f"""
üìä **–í–ê–® –ü–†–û–§–ò–õ–¨**

üë§ –ò–º—è: {update.effective_user.first_name}
üí¨ –í–æ–ø—Ä–æ—Å–æ–≤: {stats['total_messages']}
‚≠ê –ò–∑–±—Ä–∞–Ω–Ω—ã—Ö: {len(favs)}
üìÖ –° –Ω–∞–º–∏: {stats['joined_date'].strftime('%d.%m.%Y')}
"""
    
    if favs:
        stats_text += f"\n**–í–∞—à–∏ –ª—é–±–∏–º—ã–µ:** {', '.join(favs)}"
    
    await update.message.reply_text(stats_text, parse_mode="Markdown")

async def show_favorites(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    user_id = update.effective_user.id
    favs = get_user_data(user_id)["favorites"]
    
    if not favs:
        await update.message.reply_text("‚≠ê –ï—â—ë –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö. –î–æ–±–∞–≤–ª—è–π—Ç–µ –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤!", parse_mode="Markdown")
    else:
        text = "‚≠ê **–í–ê–®–ò –ò–ó–ë–†–ê–ù–ù–´–ï:**\n\n"
        for i, writer in enumerate(favs, 1):
            text += f"{i}. {writer}\n"
        await update.message.reply_text(text, parse_mode="Markdown")

async def detect_intent(message: str) -> str:
    msg = message.lower()
    
    keywords = {
        "psychology": ["–ø—Å–∏—Ö–æ–ª–æ–≥", "–≤–Ω—É—Ç—Ä–µ–Ω–Ω", "–º–æ—Ç–∏–≤", "–∞—Ä—Ö–µ—Ç–∏–ø", "–±–µ—Å—Å–æ–∑–Ω–∞—Ç–µ–ª—å"],
        "hidden": ["—Å–∫—Ä—ã—Ç", "–ø–æ–¥—Ç–µ–∫—Å—Ç", "—Å–∏–º–≤–æ–ª", "–º–µ—Ç–∞—Ñ–æ—Ä", "–Ω–µ –≤–∏–¥—è—Ç", "—Å–∫—Ä—ã—Ç—ã–π —Å–º—ã—Å–ª"],
        "comparison": ["—Å—Ä–∞–≤–Ω–∏", "–æ—Ç–ª–∏—á–∏–µ", "—Ä–∞–∑–Ω–∏—Ü–∞", "vs", "–ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç"],
        "quotes": ["—Ü–∏—Ç–∞—Ç–∞", "—Ü–∏—Ç–∞—Ç—ã", "—Ñ—Ä–∞–∑–∞", "–≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏–µ", "—Ç–µ–∑–∏—Å"],
        "recommendation": ["–ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥—É–π", "–ø–æ—Å–æ–≤–µ—Ç—É–π", "—á—Ç–æ —á–∏—Ç–∞—Ç—å", "–∫–∞–∫—É—é –∫–Ω–∏–≥—É"],
        "biography": ["–±–∏–æ–≥—Ä–∞—Ñ–∏—è", "–∂–∏–∑–Ω—å", "—Ä–∞—Å—Å–∫–∞–∂–∏ –æ", "–∏—Å—Ç–æ—Ä–∏—è", "–∫—Ç–æ –±—ã–ª"],
        "works": ["–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ", "–∫–Ω–∏–≥–∞", "—Ä–æ–º–∞–Ω", "–Ω–∞–ø–∏—Å–∞–ª", "—Ä–∞–±–æ—Ç—ã"],
        "explanation": ["–ø–æ—á–µ–º—É", "–∫–∞–∫", "–æ–±—ä—è—Å–Ω–∏", "—á—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç", "—Å–º—ã—Å–ª"],
        "influence": ["–≤–ª–∏—è–Ω–∏–µ", "–ø–æ–≤–ª–∏—è–ª", "–∏–∑–º–µ–Ω–∏–ª", "–≤–¥–æ—Ö–Ω–æ–≤–∏–ª", "–Ω–∞—Å–ª–µ–¥–∏–µ"],
        "style": ["—Å—Ç–∏–ª—å", "—è–∑—ã–∫", "—Ç–µ—Ö–Ω–∏–∫", "—Ä–∏—Ç–º", "–∑–≤—É—á–∞–Ω–∏–µ", "–ø–∏—Å—å–º–∞"],
        "philosophy": ["—Ñ–∏–ª–æ—Å–æ—Ñ", "–∏–¥–µ—è", "–º–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ", "—Å–º—ã—Å–ª", "–≤–µ—Ä–∞"],
        "modern": ["—Å–µ–≥–æ–¥–Ω—è", "—Å–µ–π—á–∞—Å", "—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å", "–∞–∫—Ç—É–∞–ª—å–Ω–æ", "–ø–æ—á–µ–º—É –≤–∞–∂–Ω–æ"]
    }
    
    for intent, words in keywords.items():
        if any(w in msg for w in words):
            return intent
    
    return "general"

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    user_id = update.effective_user.id
    user_message = update.message.text.strip()
    
    if not user_message:
        return
    
    data = get_user_data(user_id)
    data["stats"]["total_messages"] += 1
    
    intent = await detect_intent(user_message)
    if not data["current_topic"]:
        data["current_topic"] = intent
    
    conversation = get_conversation(user_id, data["current_topic"])
    conversation.append({"role": "user", "content": user_message})
    
    if len(conversation) > 20:
        conversation[:] = conversation[-20:]
    
    await update.message.chat.send_action("typing")
    
    try:
        system_prompt = SYSTEM_PROMPT
        
        intent_hints = {
            "psychology": "\nüî• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ü–†–û–°–ò–¢ –ü–°–ò–•–û–ê–ù–ê–õ–ò–ó! –†—ã—Ç—å –≤ –±–µ—Å—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–µ, –ø—Å–∏—Ö–∏–∫—É, –∞—Ä—Ö–µ—Ç–∏–ø—ã, —Ç—Ä–∞–≤–º—ã –ø–∏—Å–∞—Ç–µ–ª—è!",
            "hidden": "\nüîç –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ò–©–ï–¢ –°–ö–†–´–¢–û–ï! –†–∞—Å–∫—Ä—ã–≤–∞–π –ø–æ–¥—Ç–µ–∫—Å—Ç—ã, —Å–∏–º–≤–æ–ª–∏–∫—É, –º–µ—Ç–∞—Ñ–æ—Ä—ã, —á—Ç–æ –≤–∏–¥–Ω–æ –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫!",
            "comparison": "\n‚ö° –°–ú–ï–õ–û–ï –°–†–ê–í–ù–ï–ù–ò–ï! –ë—É–¥—å —á–µ—Å—Ç–Ω—ã–º - –∫—Ç–æ –≥–ª—É–±–∂–µ, –∫—Ç–æ —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–µ–µ, –∫—Ç–æ –≥–µ–Ω–∏–∞–ª—å–Ω–µ–µ!",
            "quotes": "\nüí¨ –¶–ò–¢–ê–¢–´! –ù–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–≤–æ–¥–∏ - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Å–º—ã—Å–ª –∫–∞–∂–¥–æ–π!",
            "influence": "\nüåç –í–õ–ò–Ø–ù–ò–ï! –ü–æ–∫–∞–∂–∏, –∫–∞–∫ –ø–∏—Å–∞—Ç–µ–ª—å –º–µ–Ω—è–ª –º–∏—Ä –∏ –∫—É–ª—å—Ç—É—Ä—É!",
            "style": "\nüé® –°–¢–ò–õ–¨! –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π —è–∑—ã–∫, —Ä–∏—Ç–º, –∑–≤—É–∫–æ–ø–∏—Å—å, –Ω–∞—Ä—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏!",
            "philosophy": "\nü§î –§–ò–õ–û–°–û–§–ò–Ø! –£–≥–ª—É–±–ª—è–π—Å—è –≤ –∏–¥–µ–∏, –º–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ, —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã!",
            "modern": "\nüöÄ –ê–ö–¢–£–ê–õ–¨–ù–û–°–¢–¨! –û–±—ä—è—Å–Ω–∏, –ü–û–ß–ï–ú–£ –≤–∞–∂–Ω–æ –°–ï–ì–û–î–ù–Ø, –∫–∞–∫ –∫–∞—Å–∞–µ—Ç—Å—è –Ω–∞—Å!"
        }
        
        if intent in intent_hints:
            system_prompt += intent_hints[intent]
        
        headers = {
            "Authorization": f"Bearer {api_key}",
            "Content-Type": "application/json",
            "HTTP-Referer": "https://replit.com",
        }
        
        if intent in ["psychology", "hidden", "philosophy"]:
            temp, tokens = 0.75, 1700
        elif intent in ["comparison", "influence"]:
            temp, tokens = 0.8, 1500
        elif intent == "recommendation":
            temp, tokens = 0.85, 1400
        else:
            temp, tokens = 0.8, 1300
        
        payload = {
            "model": MODEL,
            "messages": conversation,
            "system": system_prompt,
            "max_tokens": tokens,
            "temperature": temp,
            "top_p": 0.96,
            "frequency_penalty": 0.2,
            "presence_penalty": 0.15,
        }
        
        response = requests.post(OPEN_ROUTER_API_URL, headers=headers, json=payload, timeout=40)
        response.raise_for_status()
        
        result = response.json()
        assistant_message = result["choices"][0]["message"]["content"]
        
        conversation.append({"role": "assistant", "content": assistant_message})
        
        if len(assistant_message) > 4090:
            parts = [assistant_message[i:i+4090] for i in range(0, len(assistant_message), 4090)]
            for part in parts:
                await update.message.reply_text(part, parse_mode="Markdown")
        else:
            await update.message.reply_text(assistant_message, parse_mode="Markdown")
        
        keyboard = [
            [InlineKeyboardButton("‚ù§Ô∏è –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ", callback_data="add_fav"),
             InlineKeyboardButton("üîç –î–∞–ª—å—à–µ", callback_data="more"),
             InlineKeyboardButton("üí° –î—Ä—É–≥–æ–π –ø–∏—Å–∞—Ç–µ–ª—å", callback_data="other")]
        ]
        await update.message.reply_text("üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ?", reply_markup=InlineKeyboardMarkup(keyboard))
        
    except requests.exceptions.Timeout:
        await update.message.reply_text("‚è±Ô∏è –í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ. –ü–æ–ø—Ä–æ–±—É–π –∫–æ—Ä–æ—á–µ!")
    except requests.exceptions.RequestException as e:
        logger.error(f"API Error: {e}")
        await update.message.reply_text("‚ùå –û—à–∏–±–∫–∞ API. /clear –∏ –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞!")
    except Exception as e:
        logger.error(f"Error: {e}")
        await update.message.reply_text("üòï –û—à–∏–±–∫–∞. /clear")

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()
    
    user_id = query.from_user.id
    data = get_user_data(user_id)
    
    if query.data == "add_fav":
        if data["current_topic"] and data["current_topic"] not in data["favorites"]:
            data["favorites"].append(data["current_topic"])
            await query.edit_message_text("‚ù§Ô∏è –î–æ–±–∞–≤–ª–µ–Ω–æ!")
    elif query.data in ["favs", "help", "about", "deep", "influence", "ideas"]:
        if query.data == "favs":
            await show_favorites(update, context)
        elif query.data == "help":
            await help_command(update, context)

async def error_handler(update: object, context: ContextTypes.DEFAULT_TYPE) -> None:
    logger.error(f"Update {update} caused error {context.error}")

def main():
    app = Application.builder().token(token).build()
    
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("help", help_command))
    app.add_handler(CommandHandler("clear", clear_history))
    app.add_handler(CommandHandler("stats", show_stats))
    app.add_handler(CommandHandler("favs", show_favorites))
    app.add_handler(CallbackQueryHandler(button_handler))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    app.add_error_handler(error_handler)
    
    logger.info("=" * 70)
    logger.info("üé≠ –õ–ò–¢–ï–†–ê–¢–£–†–ù–´–ô –ë–û–¢ V5.0 –ó–ê–ü–£–©–ï–ù!")
    logger.info("üìö –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô: –í–°–ï –ü–ò–°–ê–¢–ï–õ–ò –ú–ò–†–ê")
    logger.info("üß† –°–£–ü–ï–†-–ò–ù–¢–ï–õ–õ–ï–ö–¢: –ê–ö–¢–ò–í–ò–†–û–í–ê–ù")
    logger.info("üåç –û–•–í–ê–¢: 500+ –ø–∏—Å–∞—Ç–µ–ª–µ–π –≤—Å–µ—Ö –∫—É–ª—å—Ç—É—Ä")
    logger.info("‚ö° –†–ï–ñ–ò–ú: –ì–ï–ù–ò–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó")
    logger.info("=" * 70)
    
    app.run_polling(allowed_updates=["message", "callback_query"])

if __name__ == "__main__":
    main()
